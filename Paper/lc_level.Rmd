---
output:
  html_document:
    df_print: paged
  pdf_document: default
---

# Level

Is employee emotional exhaustion, on average, high across the study? Is trainee skill low at the beginning of a training session? What value are newcomer perceptions of unit climate at the end of a two-week socialization process? These are questions about level, or the specific value of a variable. 

Levels either describe the variable at one moment or averaged across a span of time. That is, if we put a variable on the $y$ axis and plot its values against time on the $x$ axis, we can explore the value that it takes at time $t$, or the value that it takes on average across any span of $t$. 

Figure \ref{level} demonstrates this idea graphically. A variable is plotted across time, and the color labels indicate levels -- the red and green describe the variable at a specific moment while the purple, average level, describes it across a window. 

\begin{center}

------------

Insert Figure \ref{level} about here

------------

\end{center}

\noindent Our first level inference, therefore, concerns the value of a variable at a specific time or averaged across a window of time. 

#### Inference 1: What is the level of $x$ at time $t$, or across a span of $t$?

When we retain one variable but add multiple units -- people or organizations, for example -- then we can look at the variability in level. Does everyone have high affect across time? Is there variability in the level of skill among trainees at the beginning of a training session? 

We demonstrate this idea in figure \ref{level_var}, where each unit (person) has a similar trajectory but different levels at the last time point. 

\begin{center}

------------

Insert Figure \ref{level_var} about here

------------

\end{center}

\noindent The second level inference, therefore, is about level variability across units.

#### Inference 2: Across a span of $t$ or at a specific $t$ there is variability in the level of $x$.

Inferences one and two concern a single variable, but they can of course be iterated across any or all observed variables in the study. For example, we might discover that affect and performance have high average levels across time, but that affect has greater level variability. Or we might learn that affect has a low initial level whereas performance is initially high. What we are doing here is making descriptive comparisons between the level of one variable and the level of another. We can also produce a quantitative statement about the extent to which levels are related.

Correlating levels provides us with that quantitative statement. A large positive correlation between the initial levels of affect and performance would mean that people with greater initial levels of affect also tend to have greater intial performance, and people with lower initial affect also tend to have lower initial performance. 

Figure \ref{level_correlate} (no figure yet) demonstrates this graphically. Paragraph about the graph. 

#### Inference 3: There is a correlation between the level of $x$ and $y$ at $t$. 

The final level inference is horizontal. Rather than correlating values from a single moment or a single averaged moment, we correlate values across time. For example, we might ask if affect is related to performance across time; i.e., when affect is high is performance also high, and when affect is low is performance also low? This inference sounds similar to the one just presented, but their difference is important. With inference three we ask about affect and performance at $t$ or at an averaged window of $t$ -- we examine how averaged values across time of affect are related to averaged values across time of performance. Here, we ask about affect and performance across all $t$ -- we retain all of the information make a statement about the relationship between affect and performance across time.

Figure \ref{level_relation} shows this inference graphically. The top panel plots affect and performance trajectories across time. The colored squares represent levels at different points in time. The green squares highlight low values of both variables, the blue high values, and the red middle values. The bottom panel shows how those respective values map onto a graph that describes the relationship between affect and performance across time. Notice that there appears to be a positive relationship in the scatterplot, which tells us that when affect is high performance also tends to be high, and vice versa.

\begin{center}

------------

Insert Figure \ref{level_relation} about here

------------

\end{center}

#### Inference 4: There is a relationship between $x$ and $y$ across time. 


## Level Inference Table

The inference table below provides examples of each level inference. Inference one is about level itself -- a single value that describes the variable at one time or averaged across time. Inference two is about variability across units in level. Inference three takes the level in one variable and asks whether it tends to co-occur with the level in another. Inference four, finally, is about the relationship between raw values across time.

```{r, echo = F}
library(xtable)
library(knitr)
library(kableExtra)
library(tidyverse)

inference_text <- c('What is the level of x at t, or across a span of t?',
                    'There is variability in the level of x at t, or across a span of t.',
                    'There is a correlation between the level of x and the level of y at t.',
                    'There is a relationship between x and y across time.')
level_table <- data.frame(
  Inference = c(1, 2, 3, 4),
  Examples = c(linebreak('Burnout is high at the last time point.\nPerformance is low, on average, across time.'),
                 linebreak('Average affect across time differs across people (units).\nThere is variability in the initial level of turnover across organizations.'),
                 linebreak('People with greater initial health status also have greater initial happiness.\nPeople with high performance on average across time have lower anxiety on average across time.'),
                 linebreak('Affect relates to performance across time.\nHelping behaviors predict depletion across time.'))
)

level_table %>%
  kable('latex', booktabs = T, escape = F, align = 'l') %>%
    column_spec(1, width = '5em') %>%
    column_spec(2, width = '30em') %>%
  row_spec(1:3, hline_after = T)


```


## Models

Level is called intercept in the statistical modeling literature. Typically the mean estimate tells you about the level, and the variance estimate tells you about the variability across units. Intercept only models in HLM or SEM. Time-varying or invariant covariates analyses. Point to references. 


```{r, echo = F, fig.cap = "Level examples\\label{level}"}

set.seed(11)
time <- c(seq(from = 0, to = 20, by = 5))
y <- 5 + rnorm(5, 0, 2) + rnorm(5, 2, 2)
y1 <- y[1]
yend <- y[length(time)]
yave <- mean(y)


cd <- data.frame(
  'Time' = c(time),
  'Y' = c(y),
  'Legend' = c('Start', NA, 'Ave', NA, 'End'),
  'pos' = c(y1, NA, yave, NA, yend)
)

library(ggplot2)

ggplot(cd, aes(x = Time, y = Y)) + 
  geom_smooth(se = F, color = 'black') + 
  scale_y_continuous(labels = NULL) + 
  geom_point(size = 4, aes(x = Time, y = pos, color = Legend), alpha = 0.5) + 
  scale_color_manual(values = c('Start' = 'red', 'Ave' = 'blue', 'End' = 'green'),
                     labels = c('Starting Level', 'Average Level', 'Ending Level'),
                     breaks = c('Start', 'Ave', 'End')) + 
  theme_classic() + 
  theme(legend.title = element_blank()) + 
  geom_segment(aes(x = 7, y = yave, xend = 13, yend = yave), color = 'blue', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = -1, y = y1, xend = 1, yend = y1), color = 'red', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 19, y = yend, xend = 21, yend = yend), color = 'green', alpha = 0.2, linetype = 'dashed')
  


```


```{r, echo = F, fig.cap = 'Trajectories with variability in ending level across units\\label{level_var}'}

person1 <- y
person2 <- c(y[1:4] + 0.1, yend + 3)
person3 <- c(y[1:4] - 0.1, yend - 3)
per2ave <- mean(person2)
per3ave <- mean(person3)

df <- data.frame(
  'Time' = c(time),
  'Y' = c(person1, person2, person3),
  'person' = c(rep('Person 1', length(time)), rep('Person 2', length(time)), rep('Person 3', length(time))),
  'pos' = c(y1, NA, yave, NA, yend, 
            y1, NA, per2ave, NA, person2[length(time)],
            y1, NA, per3ave, NA, person3[length(time)]),
  'Legend' = c(NA, NA, NA, NA, 'End',
               NA, NA, NA, NA, 'End',
               NA, NA, NA, NA, 'End')
)


library(ggplot2)

ggplot(df, aes(x = Time, y = Y, group = person, linetype = person)) + 
  geom_smooth(se = F, color = 'black') + 
  scale_y_continuous(labels = NULL) + 
  geom_point(size = 4, aes(x = Time, y = pos, color = Legend), alpha = 0.5) + 
  scale_color_manual(values = c('End' = 'green'),
                     labels = c('Ending Level'),
                     breaks = c('End')) + 
  theme_classic() + 
  theme(legend.title = element_blank()) + 
  #geom_segment(aes(x = 7, y = yave, xend = 13, yend = yave), color = 'blue', alpha = 0.2, linetype = 'dashed') + 
  #geom_segment(aes(x = -3, y = y1, xend = 3, yend = y1), color = 'red', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 17, y = yend, xend = 23, yend = yend), color = 'green', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 17, y = person2[length(time)], xend = 23, yend = person2[length(time)]), color = 'green', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 17, y = person3[length(time)], xend = 23, yend = person3[length(time)]), color = 'green', alpha = 0.2, linetype = 'dashed')


```

```{r, echo = F, fig.cap = 'Relating affect to performance levels\\label{level_relation}', fig.height = 8}
library(tidyverse)
set.seed(2)
timer <- 20
da <- matrix(, ncol = 3, nrow = timer)

for(i in 1:timer){
  
  if(i < 6){
  da[i, 1] <- i
  da[i, 2] <- 3 + rnorm(1, 0, 4)
  da[i, 3] <- 19 + rnorm(1, 0, 1) + 0.6* da[i, 2]
  }else if (i > 5 & i < 11){
    
    da[i, 1] <- i
    da[i, 2] <- 16 + rnorm(1,0,1)
    da[i, 3] <- 32 + rnorm(1,0,1) + 0.6*da[i, 2]
  } else{
    
      da[i, 1] <- i
      da[i, 2] <- 3 + rnorm(1, 0, 4)
      da[i, 3] <- 6 + rnorm(1, 0, 1) + 0.6* da[i, 2]
    
  }
}

da <- data.frame(da)
names(da) <- c('Time', 'Affect', 'Performance')
da <- da %>%
  gather(Affect, Performance, key = 'Variable', value = 'Value')

library(ggplot2)

g1 <- ggplot(da, aes(x = Time, y = Value, group = Variable)) + 
  geom_line(aes(linetype = Variable)) + 
  theme_classic() + 
  scale_y_continuous(labels = NULL) + 
  geom_rect(aes(xmin = 2, xmax = 4, ymin = 3, ymax = 6), fill = 'red', alpha = 0.01) + 
  #geom_segment(aes(x = 3, xend = 3, y = 5, yend = 21), color = 'blue', alpha = 0.5, linetype = 'dashed') + 
  geom_rect(aes(xmin = 2, xmax = 4, ymin = 20, ymax = 23), fill = 'red', alpha = 0.01) + 
  geom_rect(aes(xmin = 18, xmax = 20, ymin = 3, ymax = 6), fill = 'green', alpha = 0.01) + 
  #geom_segment(aes(x = 17, xend = 17, y = 19, yend = 32), color = 'blue', alpha = 0.5, linetype = 'dashed') + 
  geom_rect(aes(xmin = 18, xmax = 20, ymin = -2, ymax = 1), fill = 'green', alpha = 0.01) + 
  geom_rect(aes(xmin = 7, xmax = 9, ymin = 40, ymax = 43), fill = 'blue', alpha = 0.01) + 
  geom_rect(aes(xmin = 7, xmax = 9, ymin = 16, ymax = 19), fill = 'blue', alpha = 0.01)

affect_line <- c(1:21)
perf_line <- affect_line*0.7 + rnorm(21, 0, 1)
lin_df <- data.frame(
  'Affect' = c(affect_line),
  'Performance' = c(perf_line),
  'label' = c(rep('green', 7), rep('red', 7), rep('blue', 7)))

g2 <- ggplot(lin_df, aes(x = Affect, y = Performance, color = label)) + 
  geom_point(size = 2, alpha = 0.6) + 
  theme_classic() + 
  scale_x_continuous(labels = NULL) + 
  scale_y_continuous(labels = NULL) + 
  scale_color_manual(values = c('blue' = 'blue',
                                'green' = 'green',
                                'red' = 'red')) + 
  theme(legend.position = 'none')

library(gridExtra)

grid.arrange(g1, g2, ncol = 1)
```


