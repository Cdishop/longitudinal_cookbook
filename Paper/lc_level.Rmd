---
output:
  html_document:
    df_print: paged
  pdf_document: default
---

Different literatures talk about the idea of level in different ways. In mathematical biology a variable is referred to as a state, the span of values that it can take is known as the state space, and its current value is called the condition of the state. Level is therefore synonymous with the condition of a state. Monge refers to it as magnitude. 

In the statistical literature, level is called the intercept. Level, with respect to a certain point or window in time, is called the intercept in the statistical literature, and we can make an inference about the intercept at any observation point. Sometimes we are interested in the level at the beginning of the study, other times we are interested in the level at the last observation. We can of course also be interested in the average level across time.

# Level

Is employee emotional exhaustion, on average, high across the study? Is trainee skill low at the beginning of a training session? What value are newcomer perceptions of unit climate at the end of a two-week socialization process? These are questions about level, or the specific value of a variable. 

We can think about level at a specific moment or averaged across a window of time. That is, if we put a variable on the $y$ axis and plot its values against time on the $x$ axis, we can explore the value that it takes at time $t$, or the value that it takes on average across any span of $t$. Figure \ref{level} demonstrates this idea graphically. A variable is plotted across time, and the color labels indicate levels -- two at specific $t$'s and the third averaged across time -- that we may be interested in. 

\begin{center}

------------

Insert Figure \ref{level} about here

------------

\end{center}

\noindent Our first level inference, therefore, concerns the value of a variable at a specific time or averaged across a window of time. 

#### Inference 1: What is the level of $x$ at time $t$, or across a span of $t$?

When we retain one variable but add multiple units -- people or organizations, for example -- then we can look at the variability in level. Does everyone have high affect across time? Is there variability in the level of skill among trainees at the beginning of a training session? We demonstrate this idea in figure \ref{level_var}, where each unit (person) has a similar trajectory but different levels at the last time point. 

\begin{center}

------------

Insert Figure \ref{level_var} about here

------------

\end{center}

\noindent The second level inference, therefore, is about the variability of level across units.

#### Inference 2: There is variability in the level of $x$ at time $t$, or across a span of $t$. 

Inferences one and two concern a single variable, but they can of course be iterated across any or all observed variables in a study. For example, we might discover that $x$ and $y$ have high average levels across time, but that $y$ has greater variability, suggesting individual differences in the sample. Or we might learn that $x$ has a low initial level whereas $y$'s initial level is high.

Correlating these levels is the next inference. When $x$ on average is low at the initial time point and $y$ on average is high at the initial time point, we can correlate them to discover if units (people) with low initial levels of $x$ have high initial levels on $y$ and people with high initial levels on $x$ have low initial levels on $y$. 

Figure \ref{level_correlate} demonstrates this graphically. all about the graph.

#### Inference 3: There is a correlation between the level of $x$ and $y$ at $t$. 

The final inference is horizontal. Rather than regressing a point estimate of the level on another level, we regress the values on a variable across time on another variable's values across time.

Questions.  Is the level of affect related to the level of helping behaviors across time? That is, when affect is high, are helping behaviors also high or are they low? When team cohesion is low, is team performance low as well, or is it high?


Figure \ref{level_relation}

#### Inference 4: There is a relationship between $x$ and $y$ across time. 


## Level Inference Table

```{r, echo = F, results = 'asis'}
library(xtable)
library(knitr)
library(kableExtra)
library(tidyverse)

inference_text <- c('What is the level of x at t, or across a span of t?',
                    'There is variability in the level of x at t, or across a span of t.',
                    'There is a correlation between the level of x and the level of y at t.',
                    'There is a relationship between x and y across time.')
level_table <- data.frame(
  Inference = c(1, 2, 3, 4),
  Examples = c(linebreak('Burnout is high at the last time point.\nPerformance is low, on average, across time.'),
                 linebreak('Average affect across time differs across people (units).\nThere is variability in the initial level of turnover across organizations.'),
                 linebreak('People with greater initial health status also have greater initial happiness.\nPeople with high performance on average across time have lower anxiety on average across time.'),
                 linebreak('Affect relates to performance across time.\nHelping behaviors predict depletion across time.'))
)

level_table %>%
  kable('latex', booktabs = T, escape = F, align = 'l') %>%
    column_spec(1, width = '5em') %>%
    column_spec(2, width = '30em') %>%
  row_spec(1:3, hline_after = T)


```


## Models

Intercept only models: these can be done in HLM or SEM. Time-varying or invariant covariates analysis, these can be done in HLM or SEM. Point to references. 

 


```{r, echo = F, fig.cap = "Level examples\\label{level}"}

set.seed(11)
time <- c(seq(from = 0, to = 20, by = 5))
y <- 5 + rnorm(5, 0, 2) + rnorm(5, 2, 2)
y1 <- y[1]
yend <- y[length(time)]
yave <- mean(y)


cd <- data.frame(
  'Time' = c(time),
  'Y' = c(y),
  'Legend' = c('Start', NA, 'Ave', NA, 'End'),
  'pos' = c(y1, NA, yave, NA, yend)
)

library(ggplot2)

ggplot(cd, aes(x = Time, y = Y)) + 
  geom_smooth(se = F, color = 'black') + 
  scale_y_continuous(labels = NULL) + 
  geom_point(size = 4, aes(x = Time, y = pos, color = Legend), alpha = 0.5) + 
  scale_color_manual(values = c('Start' = 'red', 'Ave' = 'blue', 'End' = 'green'),
                     labels = c('Starting Level', 'Average Level', 'Ending Level'),
                     breaks = c('Start', 'Ave', 'End')) + 
  theme_classic() + 
  theme(legend.title = element_blank()) + 
  geom_segment(aes(x = 7, y = yave, xend = 13, yend = yave), color = 'blue', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = -3, y = y1, xend = 3, yend = y1), color = 'red', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 17, y = yend, xend = 23, yend = yend), color = 'green', alpha = 0.2, linetype = 'dashed')
  


```

One variable, multiple units

```{r, echo = F, fig.cap = 'Trajectories with similar starting and average levels but different ending levels\\label{level_var}'}

person1 <- y
person2 <- c(y[1:4] + 0.1, yend + 3)
person3 <- c(y[1:4] - 0.1, yend - 3)
per2ave <- mean(person2)
per3ave <- mean(person3)

df <- data.frame(
  'Time' = c(time),
  'Y' = c(person1, person2, person3),
  'person' = c(rep('Person 1', length(time)), rep('Person 2', length(time)), rep('Person 3', length(time))),
  'pos' = c(y1, NA, yave, NA, yend, 
            y1, NA, per2ave, NA, person2[length(time)],
            y1, NA, per3ave, NA, person3[length(time)]),
  'Legend' = c(NA, NA, NA, NA, 'End',
               NA, NA, NA, NA, 'End',
               NA, NA, NA, NA, 'End')
)


library(ggplot2)

ggplot(df, aes(x = Time, y = Y, group = person, linetype = person)) + 
  geom_smooth(se = F, color = 'black') + 
  scale_y_continuous(labels = NULL) + 
  geom_point(size = 4, aes(x = Time, y = pos, color = Legend), alpha = 0.5) + 
  scale_color_manual(values = c('End' = 'green'),
                     labels = c('Ending Level'),
                     breaks = c('End')) + 
  theme_classic() + 
  theme(legend.title = element_blank()) + 
  #geom_segment(aes(x = 7, y = yave, xend = 13, yend = yave), color = 'blue', alpha = 0.2, linetype = 'dashed') + 
  #geom_segment(aes(x = -3, y = y1, xend = 3, yend = y1), color = 'red', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 17, y = yend, xend = 23, yend = yend), color = 'green', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 17, y = person2[length(time)], xend = 23, yend = person2[length(time)]), color = 'green', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 17, y = person3[length(time)], xend = 23, yend = person3[length(time)]), color = 'green', alpha = 0.2, linetype = 'dashed')


```


Muliple Variables

When affect is low performance is low. When affect is high performance is high.

```{r, echo = F, fig.cap = 'Relating affect to performance levels\\label{level_relation}', fig.height = 8}
library(tidyverse)
set.seed(2)
timer <- 20
da <- matrix(, ncol = 3, nrow = timer)

for(i in 1:timer){
  
  if(i < 6){
  da[i, 1] <- i
  da[i, 2] <- 3 + rnorm(1, 0, 4)
  da[i, 3] <- 19 + rnorm(1, 0, 1) + 0.6* da[i, 2]
  }else if (i > 5 & i < 11){
    
    da[i, 1] <- i
    da[i, 2] <- 16 + rnorm(1,0,1)
    da[i, 3] <- 32 + rnorm(1,0,1) + 0.6*da[i, 2]
  } else{
    
      da[i, 1] <- i
      da[i, 2] <- 3 + rnorm(1, 0, 4)
      da[i, 3] <- 6 + rnorm(1, 0, 1) + 0.6* da[i, 2]
    
  }
}

da <- data.frame(da)
names(da) <- c('Time', 'Affect', 'Performance')
da <- da %>%
  gather(Affect, Performance, key = 'Variable', value = 'Value')

library(ggplot2)

g1 <- ggplot(da, aes(x = Time, y = Value, group = Variable)) + 
  geom_line(aes(linetype = Variable)) + 
  theme_classic() + 
  scale_y_continuous(labels = NULL) + 
  geom_rect(aes(xmin = 2, xmax = 4, ymin = 3, ymax = 6), fill = 'red', alpha = 0.01) + 
  #geom_segment(aes(x = 3, xend = 3, y = 5, yend = 21), color = 'blue', alpha = 0.5, linetype = 'dashed') + 
  geom_rect(aes(xmin = 2, xmax = 4, ymin = 20, ymax = 23), fill = 'red', alpha = 0.01) + 
  geom_rect(aes(xmin = 18, xmax = 20, ymin = 3, ymax = 6), fill = 'green', alpha = 0.01) + 
  #geom_segment(aes(x = 17, xend = 17, y = 19, yend = 32), color = 'blue', alpha = 0.5, linetype = 'dashed') + 
  geom_rect(aes(xmin = 18, xmax = 20, ymin = -2, ymax = 1), fill = 'green', alpha = 0.01) + 
  geom_rect(aes(xmin = 7, xmax = 9, ymin = 40, ymax = 43), fill = 'blue', alpha = 0.01) + 
  geom_rect(aes(xmin = 7, xmax = 9, ymin = 16, ymax = 19), fill = 'blue', alpha = 0.01)

affect_line <- c(1:21)
perf_line <- affect_line*0.7 + rnorm(21, 0, 1)
lin_df <- data.frame(
  'Affect' = c(affect_line),
  'Performance' = c(perf_line),
  'label' = c(rep('green', 7), rep('red', 7), rep('blue', 7)))

g2 <- ggplot(lin_df, aes(x = Affect, y = Performance, color = label)) + 
  geom_point(size = 2, alpha = 0.6) + 
  theme_classic() + 
  scale_x_continuous(labels = NULL) + 
  scale_y_continuous(labels = NULL) + 
  scale_color_manual(values = c('blue' = 'blue',
                                'green' = 'green',
                                'red' = 'red')) + 
  theme(legend.position = 'none')

library(gridExtra)

grid.arrange(g1, g2, ncol = 1)
```


