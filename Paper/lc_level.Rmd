---
output:
  html_document:
    df_print: paged
  pdf_document: default
---

# Level

Is employee emotional exhaustion, on average, high across the study? Is trainee skill low at the beginning of a training session? What value are newcomer perceptions of unit climate at the end of a two-week socialization process? These are questions about level, or the specific value of a variable. 

Levels either describe the variable at one moment or averaged across a span of time. That is, if we put a variable on the $y$ axis and plot its values against time on the $x$ axis, we can explore the value that it takes at time $t$, or the value that it takes on average across any span of $t$. 

Figure \ref{level} demonstrates this idea graphically. A variable is plotted across time for a single person (i.e., unit), and the color labels indicate levels -- the red and green describe the variable at a specific moment while the purple, average level, describes it across a window. The starting level is the value of the variable at the first time point, the ending level is its value at the last time point, and the average level is its average level across time.

\begin{center}

------------

Insert Figure \ref{level} about here

------------

\end{center}

\noindent Our first level inference, therefore, concerns the value of a variable at a specific time or averaged across a window of time. 

>> **Inference 1:** What is the level of $x$ at time $t$, or across a span of $t$?

When we retain one variable but add multiple units -- people or organizations, for example -- then we can examine variability in level. Does everyone have high affect across time? Is there variability in the level of skill among trainees at the beginning of a training session? 

We demonstrate this idea in figure \ref{level_var}, where we now plot three units (people) across time. Each individual has a similar trajectory, but their ending levels of $y$ are different. The formal way to say that each person has a different level at the last time point is to say, "there is variability across units in level at the last time point." 

\begin{center}

------------

Insert Figure \ref{level_var} about here

------------

\end{center}

\noindent The second level inference, therefore, is about level variability across units.

>> **Inference 2:** Across a span of $t$ or at a specific $t$ there is variability in the level of $x$.

Inferences one and two concern a single variable, but they can of course be iterated across any or all observed variables in the study (remember that variables are different than units). For example, we might discover that affect and performance have high average levels across time, but that affect has greater level variability across units. Or we might learn that affect has a low initial level whereas performance is initially high. What we are doing here is making descriptive comparisons between the level of one variable and the level of another. We can also produce a quantitative statement about the extent to which levels are related.

Correlating levels provides us with that quantitative statement. A large positive correlation between the initial levels of affect and performance would mean that people with greater initial levels of affect also tend to have greater intial performance, and people with lower initial affect also tend to have lower initial performance. 

Figure \ref{level_correlate} demonstrates a correlation of starting levels. In Panel A we plot affect and performance trajectories for three individuals across time, where the black solid line indicates affect and the dashed line indicates performance. We indicate starting levels for both variables in Panel A by placing colored circles on the graph for each individual. For example, we indicate the starting levels of affect and performance for person 1 with a red circle, and the starting levels for person two with green circles. 
Panel B of figure \ref{level_correlate} maps those starting levels onto a new plot that leads to our inference. On the $x$-axis is initial level of affect, where high values indicate a high starting level of affect, and on the $y$-axis is initial level of performance, where high values indicate a high starting level of performance. The red circle for person 1 is on the bottom right because that individual has a high initial level of affect and a low initial level of performance. Person 2 (the green circle) is on the top left because that individual has a high initial level of performance and a low initial level of affect, and person 3 is in the middle. The overall relationship in Panel B is negative, the dots slope downward which tells us that there is a negative relationship between initial level of affect and initial level of performance. 

Overall, figure \ref{level_correlate} tells us that the starting levels of affect and performance are correlated. Panel A shows the actual starting levels, and Panel B shows that there is a strong negative correlation between initial affect and initial performance. This negative relationship means that we expect people with low initial affect to have high initial performance, whereas we expect people with high initial affect to have low initial performance. 

>> **Inference 3:** There is a correlation between the level of $x$ and the level of $y$ at $t$. 

In our final level inference we correlate values across time rather than correlating values from a single moment or a single averaged moment. For example, we might ask if affect is related to performance across time; i.e., when affect is high is performance also high, and when affect is low is performance also low? 

This inference sounds similar to the one just presented, but their difference is important. With inference three we ask about affect and performance at $t$ or at an averaged window of $t$ -- we examine, for example, how ending performance relates to ending affect, or how affect averaged across all time relates to performance averaged across all time. Here, we retain all of the information and examine the relationship between affect and performance across all $t$. 

Figure \ref{level_relation} shows this inference graphically. In Panel A we plot affect and performance trajectories across time, where the solid line indicates affect and the dashed line indicates performance -- this time we only focus on a single individual or unit. The colored squares represent levels at different points in time. The green squares highlight low values of both variables, the blue high values, and the red middle values. 

Panel B shows how those respective values map onto a scatterplot of affect and performance -- which again will lead us to the inference. The blue values indicate that high values of affect tend to co-occur with high values of performance (shown respectively by the blue scquares in Panel A). The red values indicate that middle values of affect tend to co-occur with middle values of performance. The green values, finally, indicate that low values of affect tend to co-occur with low values of performance. Across time, affect and performance covary. 

\begin{center}

------------

Insert Figure \ref{level_relation} about here

------------

\end{center}

>> **Inference 4:** There is a relationship between $x$ and $y$ across time. 


## Level Inference Table

The inference table below provides examples of each level inference. Inference one is about level itself -- a single value that describes the variable at one time or averaged across time. Inference two is about variability across units in level. Inference three takes the level in one variable and asks whether it tends to co-occur with the level in another. Think of inference three as creating a latent level variable at a single moment and asking how it relates to another latent variable from a single moment. Inference four, finally, is about the relationship between raw values across time.

```{r, echo = F}
library(xtable)
library(knitr)
library(kableExtra)
library(tidyverse)

inference_text <- c('What is the level of x at t, or across a span of t?',
                    'There is variability in the level of x at t, or across a span of t.',
                    'There is a correlation between the level of x and the level of y at t.',
                    'There is a relationship between x and y across time.')
level_table <- data.frame(
  Inference = c(1, 2, 3, 4),
  Examples = c(linebreak('Burnout is high at the last time point.\nPerformance is low, on average, across time.'),
                 linebreak('Average affect across time differs across people (units).\nThere is variability in the initial level of turnover across organizations.'),
                 linebreak('People with greater initial health status also have greater initial happiness.\nPeople with high performance on average across time have lower anxiety on average across time.'),
                 linebreak('Affect relates to performance across time.\nHelping behaviors predict depletion across time.'))
)

level_table %>%
  kable('latex', booktabs = T, escape = F, align = 'l') %>%
    column_spec(1, width = '5em') %>%
    column_spec(2, width = '30em') %>%
  row_spec(1:3, hline_after = T)


```


## Models

Level is called intercept in the statistical modeling literature. Typically the mean estimate tells you about the level, and the variance estimate tells you about the variability across units. Intercept only models in HLM or SEM. Time-varying or invariant covariates analyses. Point to references. 


```{r, echo = F, fig.cap = "Level examples\\label{level}"}

set.seed(11)
time <- c(seq(from = 0, to = 20, by = 5))
y <- 5 + rnorm(5, 0, 2) + rnorm(5, 2, 2)
y1 <- y[1]
yend <- y[length(time)]
yave <- mean(y)


cd <- data.frame(
  'Time' = c(time),
  'Y' = c(y),
  'Legend' = c('Start', NA, 'Ave', NA, 'End'),
  'pos' = c(y1, NA, yave, NA, yend)
)

library(ggplot2)

ggplot(cd, aes(x = Time, y = Y)) + 
  geom_smooth(se = F, color = 'black') + 
  scale_y_continuous(labels = NULL) + 
  geom_point(size = 4, aes(x = Time, y = pos, color = Legend), alpha = 0.5) + 
  scale_color_manual(values = c('Start' = 'red', 'Ave' = 'blue', 'End' = 'green'),
                     labels = c('Starting Level', 'Average Level', 'Ending Level'),
                     breaks = c('Start', 'Ave', 'End')) + 
  theme_classic() + 
  theme(legend.title = element_blank()) + 
  geom_segment(aes(x = 7, y = yave, xend = 13, yend = yave), color = 'blue', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = -1, y = y1, xend = 1, yend = y1), color = 'red', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 19, y = yend, xend = 21, yend = yend), color = 'green', alpha = 0.2, linetype = 'dashed')
  


```


```{r, echo = F, fig.cap = 'Trajectories with variability in ending level across units\\label{level_var}'}

person1 <- y
person2 <- c(y[1:4] + 0.1, yend + 3)
person3 <- c(y[1:4] - 0.1, yend - 3)
per2ave <- mean(person2)
per3ave <- mean(person3)

df <- data.frame(
  'Time' = c(time),
  'Y' = c(person1, person2, person3),
  'person' = c(rep('Person 1', length(time)), rep('Person 2', length(time)), rep('Person 3', length(time))),
  'pos' = c(y1, NA, yave, NA, yend, 
            y1, NA, per2ave, NA, person2[length(time)],
            y1, NA, per3ave, NA, person3[length(time)]),
  'Legend' = c(NA, NA, NA, NA, 'End',
               NA, NA, NA, NA, 'End',
               NA, NA, NA, NA, 'End')
)


library(ggplot2)

ggplot(df, aes(x = Time, y = Y, group = person, linetype = person)) + 
  geom_smooth(se = F, color = 'black') + 
  scale_y_continuous(labels = NULL) + 
  geom_point(size = 4, aes(x = Time, y = pos, color = Legend), alpha = 0.5) + 
  scale_color_manual(values = c('End' = 'green'),
                     labels = c('Ending Level'),
                     breaks = c('End')) + 
  theme_classic() + 
  theme(legend.title = element_blank()) + 
  #geom_segment(aes(x = 7, y = yave, xend = 13, yend = yave), color = 'blue', alpha = 0.2, linetype = 'dashed') + 
  #geom_segment(aes(x = -3, y = y1, xend = 3, yend = y1), color = 'red', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 17, y = yend, xend = 23, yend = yend), color = 'green', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 17, y = person2[length(time)], xend = 23, yend = person2[length(time)]), color = 'green', alpha = 0.2, linetype = 'dashed') + 
  geom_segment(aes(x = 17, y = person3[length(time)], xend = 23, yend = person3[length(time)]), color = 'green', alpha = 0.2, linetype = 'dashed')


```




```{r, echo = F, fig.cap = 'Correlating starting levels, or relating initial affect to initial performance\\label{level_correlate}', fig.height = 10}
library(ggplot2)
set.seed(38)

ind <- c(1:20)
lev_affect <- c(10, 7, (8 + rnorm(18,0,1)))
lev_perf <- c(1, 3, (6 + rnorm(18,0,1))) 

lev_affect2 <- c(1, (2 + rnorm(19,0,1)))
lev_perf2 <- c(10, 7, 4, (2 + rnorm(17,0,1)))

lev_affect3 <- c(5, (7 + rnorm(19,0,1)))
lev_perf3 <- c(4.8, (2 + rnorm(19,0,1)))

lev_rel <- data.frame(
  'Time' = c(ind, ind,
             ind, ind,
             ind, ind),
  'Value' = c(lev_affect, lev_perf,
          lev_affect2, lev_perf2,
          lev_affect3, lev_perf3),
  'call' = c(rep('Affect', 20),
              rep('Performance', 20),
             rep('Affect', 20),
             rep('Performance', 20),
             rep('Affect', 20),
             rep('Performance', 20)),
  'Person' = c(rep('Person 1', 40),
               rep('Person 2', 40),
               rep('Person 3', 40)),
  'pos' = c(
    10, rep(NA, 19),
    1, rep(NA, 19),
    1, rep(NA, 19),
    10, rep(NA, 19),
    5, rep(NA, 19),
    4.8, rep(NA, 19)
  )
)



lev_relate1 <- ggplot(lev_rel, aes(x = Time, y = Value, group = call)) + 
  #geom_smooth(aes(linetype = call), se = F, color = 'black', span = 0.4) + 
  geom_line(aes(linetype = call)) + 
  theme_classic() + 
  scale_y_continuous(labels = NULL) + 
  theme(legend.title = element_blank()) + 
  facet_grid(~Person, scales = 'free', space = 'free') + 
  geom_point(size = 4, aes(y = pos, color = Person), show.legend = F, alpha = 0.6) +
  scale_color_manual(values = c('Person 1' = 'red',
                                'Person 2' = 'green',
                                'Person 3' = 'blue')) + 
  ggtitle('Panel A')



lev_lev <- data.frame(
  'Affect' = c(1, 5, 10),
  'Performance' = c(10, 5, 1),
  'label' = c('green', 'blue', 'red')
)

lev_relate2 <- ggplot(lev_lev, aes(x = Affect, y = Performance, color = label)) + 
  geom_point(size = 6, alpha = 0.6) + 
  theme_classic() + 
  scale_y_continuous(breaks = c(0, 5, 11)) + 
  scale_x_continuous(breaks = c(0, 5, 11)) + 
  ylab("Initial Level of Performance") + 
  xlab("Initial Level of Affect") + 
  ggtitle('Panel B') + 
  theme(legend.title = element_blank()) + 
  theme(
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank()
  ) + 
  scale_color_manual(values = c('red' = 'red', 
                                'blue' = 'blue',
                                'green' = 'green'),
                     labels = c('Person 3',
                                'Person 2',
                                'Person 1'))
                     #breaks = c('Person 1',
                          #      'Person 2',
                           #     'Person 3'))

library(gridExtra)

grid.arrange(lev_relate1, lev_relate2, ncol = 1)

```





```{r, echo = F, fig.cap = 'Relating affect to performance levels\\label{level_relation}', fig.height = 8}
library(tidyverse)
set.seed(2)
timer <- 20
da <- matrix(, ncol = 3, nrow = timer)

for(i in 1:timer){
  
  if(i < 6){
  da[i, 1] <- i
  da[i, 2] <- 3 + rnorm(1, 0, 4)
  da[i, 3] <- 19 + rnorm(1, 0, 1) + 0.6* da[i, 2]
  }else if (i > 5 & i < 11){
    
    da[i, 1] <- i
    da[i, 2] <- 16 + rnorm(1,0,1)
    da[i, 3] <- 32 + rnorm(1,0,1) + 0.6*da[i, 2]
  } else{
    
      da[i, 1] <- i
      da[i, 2] <- 3 + rnorm(1, 0, 4)
      da[i, 3] <- 6 + rnorm(1, 0, 1) + 0.6* da[i, 2]
    
  }
}

da <- data.frame(da)
names(da) <- c('Time', 'Affect', 'Performance')
da <- da %>%
  gather(Affect, Performance, key = 'Variable', value = 'Value')

library(ggplot2)

g1 <- ggplot(da, aes(x = Time, y = Value, group = Variable)) + 
  geom_line(aes(linetype = Variable)) + 
  theme_classic() + 
  scale_y_continuous(labels = NULL) + 
  geom_rect(aes(xmin = 2, xmax = 4, ymin = 3, ymax = 6), fill = 'red', alpha = 0.03) + 
  #geom_segment(aes(x = 3, xend = 3, y = 5, yend = 21), color = 'blue', alpha = 0.5, linetype = 'dashed') + 
  geom_rect(aes(xmin = 2, xmax = 4, ymin = 20, ymax = 23), fill = 'red', alpha = 0.03) + 
  geom_rect(aes(xmin = 18, xmax = 20, ymin = 3, ymax = 6), fill = 'green', alpha = 0.03) + 
  #geom_segment(aes(x = 17, xend = 17, y = 19, yend = 32), color = 'blue', alpha = 0.5, linetype = 'dashed') + 
  geom_rect(aes(xmin = 18, xmax = 20, ymin = -2, ymax = 1), fill = 'green', alpha = 0.03) + 
  geom_rect(aes(xmin = 7, xmax = 9, ymin = 40, ymax = 43), fill = 'blue', alpha = 0.03) + 
  geom_rect(aes(xmin = 7, xmax = 9, ymin = 16, ymax = 19), fill = 'blue', alpha = 0.03) + 
  ggtitle('Panel A')

affect_line <- c(1:21)
perf_line <- affect_line*0.7 + rnorm(21, 0, 1)
lin_df <- data.frame(
  'Affect' = c(affect_line),
  'Performance' = c(perf_line),
  'label' = c(rep('green', 7), rep('red', 7), rep('blue', 7)))

g2 <- ggplot(lin_df, aes(x = Affect, y = Performance, color = label)) + 
  geom_point(size = 2, alpha = 0.6) + 
  theme_classic() + 
  scale_x_continuous(labels = NULL) + 
  scale_y_continuous(labels = NULL) + 
  scale_color_manual(values = c('blue' = 'blue',
                                'green' = 'green',
                                'red' = 'red')) + 
  theme(legend.position = 'none') + 
  ggtitle('Panel B')

library(gridExtra)

grid.arrange(g1, g2, ncol = 1)
```


